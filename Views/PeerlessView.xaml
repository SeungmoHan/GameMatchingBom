<UserControl x:Class="NewMatchingBom.Views.PeerlessView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:hc="https://handyorg.github.io/handycontrol">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header Card -->
        <hc:Card Grid.Row="0" Style="{StaticResource ModernCard}" Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="✨ 피어리스 (챔피언 선택)" 
                          Style="{StaticResource TitleText}"
                          Foreground="{StaticResource PrimaryBrush}"/>

                <!-- Search and Controls Section -->
                <Border Background="{StaticResource SurfaceBrush}" 
                       CornerRadius="8" 
                       Padding="20"
                       Margin="0,0,0,20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Top Controls -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Search -->
                            <hc:SearchBar Grid.Column="0" 
                                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                         hc:InfoElement.Placeholder="챔피언 이름으로 검색..."
                                         Style="{StaticResource ModernTextBox}"
                                         Height="40"
                                         Margin="0,0,20,0"/>

                            <!-- Random Pick Section -->
                            <Border Grid.Column="1" 
                                   Background="{StaticResource CardBgBrush}"
                                   CornerRadius="8"
                                   Padding="15,8"
                                   Margin="0,0,15,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="랜덤 선택:" 
                                              Style="{StaticResource BodyText}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,8,0"/>
                                    <hc:NumericUpDown Value="{Binding RandomPickCount}" 
                                                     Minimum="1" 
                                                     Maximum="10"
                                                     Width="60"
                                                     Height="26"
                                                     Margin="0,0,8,0"/>
                                    <Button Content="🎲 선택" 
                                           Command="{Binding PickRandomCommand}"
                                           Style="{StaticResource WarningButton}"
                                           Height="32"
                                           Padding="12,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Action Buttons -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <Button Content="↩️ 취소" 
                                       Command="{Binding RevertSelectedCommand}"
                                       Style="{StaticResource AccentButton}"
                                       Height="40"
                                       Padding="15,0"
                                       Margin="0,0,10,0"/>
                                <Button Content="✅ 확정" 
                                       Command="{Binding CommitSelectedCommand}"
                                       Style="{StaticResource SuccessButton}"
                                       Height="40"
                                       Padding="15,0"/>
                            </StackPanel>
                        </Grid>

                        <!-- Status Information -->
                        <Border Grid.Row="1" 
                               Background="{StaticResource CardBgBrush}" 
                               CornerRadius="8" 
                               Padding="15"
                               Margin="0,15,0,0">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Border Background="{Binding IsLoaded, Converter={StaticResource BooleanToBrushConverter}}" 
                                       CornerRadius="12" 
                                       Padding="8,4" 
                                       Margin="0,0,15,0">
                                    <TextBlock Text="{Binding IsLoaded, StringFormat='로딩: {0}'}" 
                                              Foreground="White"
                                              FontWeight="Medium"
                                              FontSize="12"/>
                                </Border>
                                
                                <Border Background="{StaticResource AccentBrush}" 
                                       CornerRadius="12" 
                                       Padding="8,4" 
                                       Margin="0,0,15,0">
                                    <TextBlock Text="{Binding TotalChampionCount, StringFormat='전체: {0}'}" 
                                              Foreground="White"
                                              FontWeight="Medium"
                                              FontSize="12"/>
                                </Border>
                                
                                <Border Background="{StaticResource PrimaryBrush}" 
                                       CornerRadius="12" 
                                       Padding="8,4" 
                                       Margin="0,0,15,0">
                                    <TextBlock Text="{Binding CurrentChampionCount, StringFormat='남은: {0}'}" 
                                              Foreground="White"
                                              FontWeight="Medium"
                                              FontSize="12"/>
                                </Border>
                                
                                <Border Background="{StaticResource WarningBrush}" 
                                       CornerRadius="12" 
                                       Padding="8,4">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="선택: " 
                                                  Foreground="White"
                                                  FontWeight="Medium"
                                                  FontSize="12"/>
                                        <TextBlock Text="{Binding SelectedChampions.Count}" 
                                                  Foreground="White"
                                                  FontWeight="Bold"
                                                  FontSize="12"/>
                                        <TextBlock Text="/" 
                                                  Foreground="White"
                                                  FontSize="12"/>
                                        <TextBlock Text="{Binding SelectedCount}" 
                                                  Foreground="White"
                                                  FontWeight="Bold"
                                                  FontSize="12"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </StackPanel>
        </hc:Card>

        <!-- Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Available Champions -->
            <hc:Card Grid.Column="0" Style="{StaticResource ModernCard}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" 
                              Text="🏰 사용 가능한 챔피언" 
                              Style="{StaticResource SubtitleText}"/>

                    <Border Grid.Row="1"
                           Background="{StaticResource SurfaceBrush}"
                           CornerRadius="8"
                           Padding="15">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding FilteredRemainedChampions}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource CardBgBrush}" 
                                               CornerRadius="12" 
                                               Padding="8" 
                                               Margin="4"
                                               Width="90"
                                               Height="120"
                                               BorderBrush="{StaticResource SurfaceBrush}"
                                               BorderThickness="1"
                                               Cursor="Hand">
                                            <Border.Effect>
                                                <DropShadowEffect Color="Black" Opacity="0.15" ShadowDepth="2" BlurRadius="8"/>
                                            </Border.Effect>
                                            <StackPanel>
                                                <Border CornerRadius="8" 
                                                       ClipToBounds="True"
                                                       Margin="0,0,0,5">
                                                    <Image Source="{Binding ChampionImage}" 
                                                          Width="55" 
                                                          Height="55"
                                                          Stretch="Uniform"/>
                                                </Border>
                                                <TextBlock Text="{Binding ChampionNameKor}" 
                                                          Foreground="{StaticResource TextPrimaryBrush}"
                                                          FontSize="10"
                                                          FontWeight="Medium"
                                                          TextAlignment="Center"
                                                          TextWrapping="Wrap"
                                                          Margin="0,0,0,5"/>
                                                <Button Content="➕" 
                                                       Command="{Binding DataContext.AddSelectedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding}"
                                                       Style="{StaticResource SuccessButton}"
                                                       Width="24" Height="24"
                                                       FontSize="12"
                                                       Padding="0"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </hc:Card>

            <!-- Selected Champions -->
            <hc:Card Grid.Column="2" Style="{StaticResource ModernCard}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <TextBlock Text="✅ 선택된 챔피언" 
                                  Style="{StaticResource SubtitleText}"/>
                        <Border Background="{StaticResource SuccessBrush}" 
                               CornerRadius="12" 
                               Padding="8,4"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0">
                            <TextBlock Text="{Binding SelectedChampions.Count, StringFormat='{}{0}개'}" 
                                      Foreground="White"
                                      FontWeight="Bold"
                                      FontSize="12"/>
                        </Border>
                    </StackPanel>

                    <Border Grid.Row="1"
                           Background="{StaticResource SurfaceBrush}"
                           CornerRadius="8"
                           Padding="10">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding SelectedChampions}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource SuccessBrush}" 
                                               CornerRadius="10" 
                                               Padding="12,8" 
                                               Margin="0,0,0,8"
                                               Opacity="0.9">
                                            <Border.Effect>
                                                <DropShadowEffect Color="Black" Opacity="0.2" ShadowDepth="2" BlurRadius="6"/>
                                            </Border.Effect>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0" 
                                                       CornerRadius="6" 
                                                       ClipToBounds="True"
                                                       Margin="0,0,10,0">
                                                    <Image Source="{Binding ChampionImage}" 
                                                          Width="32" 
                                                          Height="32"/>
                                                </Border>

                                                <TextBlock Grid.Column="1" 
                                                          Text="{Binding ChampionNameKor}" 
                                                          Foreground="White"
                                                          FontWeight="SemiBold"
                                                          VerticalAlignment="Center"
                                                          FontSize="13"/>

                                                <Button Grid.Column="2" 
                                                       Content="➖" 
                                                       Command="{Binding DataContext.RemoveSelectedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding}"
                                                       Style="{StaticResource DangerButton}"
                                                       Width="28" Height="28"
                                                       FontSize="12"
                                                       Padding="0"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </hc:Card>

            <!-- Used Champions -->
            <hc:Card Grid.Column="4" Style="{StaticResource ModernCard}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <TextBlock Text="🚫 사용된 챔피언" 
                                  Style="{StaticResource SubtitleText}"/>
                        <Border Background="{StaticResource DangerBrush}" 
                               CornerRadius="12" 
                               Padding="8,4"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0">
                            <TextBlock Text="{Binding UsedChampions.Count, StringFormat='{}{0}개'}" 
                                      Foreground="White"
                                      FontWeight="Bold"
                                      FontSize="12"/>
                        </Border>
                    </StackPanel>

                    <Border Grid.Row="1"
                           Background="{StaticResource SurfaceBrush}"
                           CornerRadius="8"
                           Padding="10"
                           Margin="0,15,0,15">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding UsedChampions}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource CardBgBrush}" 
                                               CornerRadius="8" 
                                               Padding="10,6" 
                                               Margin="0,0,0,6"
                                               BorderBrush="{StaticResource SurfaceBrush}"
                                               BorderThickness="1"
                                               Opacity="0.7">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0" 
                                                       CornerRadius="4" 
                                                       ClipToBounds="True"
                                                       Margin="0,0,8,0">
                                                    <Image Source="{Binding ChampionImage}" 
                                                          Width="28" 
                                                          Height="28"/>
                                                </Border>

                                                <TextBlock Grid.Column="1" 
                                                          Text="{Binding ChampionNameKor}" 
                                                          Foreground="{StaticResource TextSecondaryBrush}"
                                                          VerticalAlignment="Center"
                                                          FontSize="12"/>

                                                <Button Grid.Column="2" 
                                                       Content="↩️" 
                                                       Command="{Binding DataContext.RemoveUsedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding}"
                                                       Style="{StaticResource AccentButton}"
                                                       Width="26" Height="26"
                                                       FontSize="10"
                                                       Padding="0"
                                                       ToolTip="복구"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>

                    <Button Grid.Row="2" 
                           Content="🔄 전체 복구" 
                           Command="{Binding RevertUsedCommand}"
                           Style="{StaticResource WarningButton}"
                           Height="45"
                           FontWeight="Bold"/>
                </Grid>
            </hc:Card>
        </Grid>
    </Grid>
</UserControl>